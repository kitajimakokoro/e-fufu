<div class="container">
  <h1 class="my-5"><strong>ふうふのホンネ</strong></h1>
  <div class="row mx-5">
    <div class="col-mb-2 mr-4">
      <table class="table table-borderless rounded text-center" style="background-color: #FAF0E6" >
        <thead>
          <tr>
            <th class="h3">
              <strong>｜ カテゴリ ｜</strong>
            </th>
          </tr>
        </thead>
        <tbody>
        <% @categories.each do |category| %>
          <tr>
            <!--  post_path(投稿一覧ページ)のカテゴリIDには取得したカテゴリIDを渡す  -->
            <td><%= link_to category.name, posts_path(category_id: category.id), class: "text-reset" %></td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
    <!--  検索窓  -->
    <div class="col-9">
      <div class="row mb-3">
          <%= form_with url: search_posts_path, local:true, method: :get do |f| %>
            <div class="input-group col-12">
              <%= f.text_field :keyword, class: "form-control search-control mr-1", placeholder: "Search..." %>
              <%= button_tag type: "submit", class: "btn btn-light " do %>
                <i class="fas fa-search"></i>
              <% end %>
            </div>
          <% end %>

        <!-- 新規登録ボタン-->
        <div class="col-3 ml-auto text-right">
           <%= link_to "投稿する", new_post_path, class: "btn", style:"color:#FFFFFF; background-color:#696969;" %>
        </div>
      </div>

<div class="list-group" style= "width: 100%">
<% @posts.each do |post| %>
<% if post.user.is_deleted == false %>
<div>
  <div class="list-group-item list-group-item-action">
    <div class="row">
      <div class="col-2 text-center">
    <%= image_tag post.user.get_profile_image(70,70), class:"rounded-circle" %>
    </div>
    <div class="col-10">
    <p><i class="fas fa-tag"></i><%= post.category.name %>
  <%= link_to post_path(post.id), class: "text-reset" do %>
  <%= truncate(post.text, length:28) %>
  <% end %></p>
  <span>
    <% if post.liked_by?(current_user) %>
    <!--  含まれている時いいねを外す  -->
      <%= link_to post_likes_path(post), method: :delete, class:"text-reset text-decoration-none" do %>
        <i class="fas fa-heart" style="color: #B22222;"></i>
        <%= post.likes.count %>　|
      <% end %>
    <% else %>
    <!--  含まれている時いいねをする  -->
      <%= link_to post_likes_path(post), method: :post, class:"text-reset text-decoration-none" do %>
      <i class="far fa-heart" style="color:#A9A9A9"></i>
      <%= post.likes.count %>　|
      <% end %>
  <% end %>
  </span>
  　<i class="far fa-comment" style="color:#A9A9A9"></i>
  <%= post.post_comments.count %>　｜
    <%= post.created_at.strftime('%Y/%m/%d') %>

  </div>
   </div>
</div>
<% else %>  <!--退会している場合の処理(is_deleted:true)-->
  <!--投稿自体を表示しない-->
<% end %>
<% end %>
</div>
</div>
    </div>
    </div>